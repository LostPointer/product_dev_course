# Пошаговый план работ (без кода) — ретрофит готовой RC‑машины

Цель: получить машину, которая управляется **со смартфона по Wi‑Fi** и **с RC‑пульта**, с телеметрией IMU и безопасным поведением при потере связи.

## 0) До покупки базы (самое важное)
- Открыть `docs/car_candidates_ru.md` и выбрать 1–2 семейства, которые вам нравятся по типу (краулер/пикап/шорт‑корс).
- Принять стратегию:
  - **Ветка A (выбрана)**: база должна позволять управлять штатным регулятором (ESC) и рулевым сервоприводом через **классический PWM** (как от обычного RC‑приёмника).
  - **Ветка B (план‑B)**: если выяснится, что штатная плата не имеет стандартных входов/разъёмов и “врезаться” в PWM нельзя — готовим замену электроники на стандартные узлы.

## 1) Закупка электроники (параллельно с покупкой машинки)
- По списку из `docs/bom_ru.md`.
- Сверить общий бюджет по `docs/budget_ru.md` (особенно если добавляете RC‑пульт+приёмник).

## 2) Первичная диагностика после покупки (10–15 минут)
- Снять кузов и зафиксировать:
  - есть ли **отдельный рулевой сервопривод** (3 провода)?
  - мотор **brushed (2 провода)** или **brushless (3 провода)**?
  - есть ли понятные разъёмы / возможность подать PWM на газ/руль?
  - как организовано питание (есть ли BEC 5V и где его брать)?

Результат: окончательно выбрать ветку **A** или **B**.

### Результат диагностики по Himoto SCT‑16 (по фото)
- Есть отдельный **RC‑приёмник Himoto 2.4GHz 4CH** с обычными 3‑pin разъёмами `CH1..CH4` → это означает **стандартный PWM** и хорошую совместимость с веткой A.
- Отдельный ESC установлен отдельно от приёмника (не “комбо‑плата”) → проще “врезаться” между приёмником и ESC/серво.

## 3) Электрическая интеграция
### Ветка A
- Подать PWM с нового контроллера на штатный ESC и рулевой сервопривод (или на входы `THR/STR`, если они есть).

### Ветка B
- Заменить штатную плату на стандартные узлы:
  - ESC (brushed или brushless — по вашему мотору) + BEC 5V
  - (при необходимости) рулевой сервопривод

## 4) Два источника управления
- **Wi‑Fi управление**: телефон → ESP32 (AP/точка доступа) → UART → STM32 (концептуально).
- **RC управление**: RC‑приёмник → STM32 (PWM/PPM/SBUS — выбираете по железу).
- Задать правило приоритета и безопасный таймаут (failsafe) — см. `docs/interfaces_protocols.md`.

## 5) IMU
- Установить IMU на шасси жёстко (минимум вибраций), согласовать оси.
- Для начала достаточно: чтение accel/gyro и вывод в телеметрию; дальше можно добавлять режимы стабилизации.

Если вы целитесь в **устойчивость/контроль заноса**, то на практике потребуется:
- высокая частота чтения IMU и управления (ориентир: 200–500 Гц для контуров по gyro),
- хорошие шины/подвеска (это “бесплатная” стабильность),
- (опционально, но сильно помогает) датчики скорости колёс/одометрия, если захочется контролировать пробуксовку, а не только рыскание.

## 6) (Опционально, позже) Датчики скорости колёс
- Заложить места под датчики заранее: где можно закрепить магнит и датчик (на кардане/спуре/ступице), чтобы проводка не цеплялась за подвеску.
- Начать можно с **1 датчика** (общая “скорость”), а затем расширить до 2–4 датчиков (по колёсам) — это уже даёт основу для контроля пробуксовки.

## 7) Тесты безопасности (обязательно)
- Потеря Wi‑Fi → газ в ноль/нейтраль.
- Потеря RC → газ в ноль/нейтраль.
- Переключение источников управления → без рывка/без “внезапного газа”.

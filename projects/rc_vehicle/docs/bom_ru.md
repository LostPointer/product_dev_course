# BOM (что купить) под STM32 + ESP32 + IMU + 2 источника управления

Оценку стоимости по веткам A/B и с/без RC‑пульта см. в `docs/budget_ru.md`.

## Зафиксированная база (шасси)
- **Himoto SCT‑16 4WD RTR 1:16 2.4G (HI4192|RED)** — [карточка на Яндекс Маркете](https://market.yandex.ru/card/radioupravlyayemyy-short-kors-trak-himoto-sct-16-4wd-rtr-masshtab-116-24g---hi4192red/4399880474?do-waremd5=9jRAzA7SdRMQfoiYw52cAw&cpc=d2PGwzy0QTs0eLnRlKp0k5YCu2JHodVzFJDvJtshUWzSyDz3E9FKzWqRWc9gIULXX9EJ9Ku-0mvQsCTCCBzwqE-a6FjyS4PfsjEQ8zw1WU-FqmGO5HghkO4aplP4qdbhCmxXetVCLQqycN6o03nHXP_tLSTfOP2glbQ73t_oCvPUAJbjP6PtzyvAx9EZdLsM_MZD6JCx9hF2cmhA0Yc88aMXOZ_Ei1IVvZjbvcsvgHDewTubfOP7WxmSPsCnzZvbiXsTE30oPZ2PX6ct5WAkjK3DLf9791pMdJqhKAAkwv7LcDElOfELc6S0wxkUen63wrtSxWiKAo38hVIlcprRM84HQu9ao5TKsC9LjxYBM0hP5J5NaEfI0IHukClWKjyg9bwUETyJZKEokhHrUvGdfPVfDCgSMMCBr0cFhxl4T4GRgdt4k6KP_xjqOGhNoV-7&ogV=-9)
- Целевой путь проекта: **ветка A** (оставляем штатные ESC/серво, STM32 выдаёт PWM), но держим **ветку B** как plan‑B на случай “toy‑grade” платы без стандартных входов.

Ниже — практичный список компонентов, рассчитанный на **ретрофит готовой машинки**. Он покрывает обе ветки:
- **Ветка A**: остаётся штатный ESC и серва, STM32 выдаёт на них PWM.
- **Ветка B**: меняем «игрушечную» плату на стандартные узлы (ESC+BEC и т.п.).

На текущем этапе мы **целимся в ветку A**. Это накладывает требования к базе: штатный ESC/серво должны принимать **обычный PWM**, как от RC‑приёмника.

## Базовый комплект (почти всегда нужен)
- **STM32 dev‑плата**:
  - рекомендую: BlackPill `STM32F411CEU6` (3.3V логика, достаточно ресурсов)
  - выбранный вариант: плата/контроллер на `STM32F411CEU6` с `USB Type‑C` — [Яндекс Маркет](https://market.yandex.ru/card/kontroller-stm32f411-na-baze-stm32f411ceu6-razyem-type-c/102621980775?do-waremd5=YdGo0HngSYzQG131FZEWzw&ogV=-9)
  - альтернатива: Nucleo F4 (удобнее в отладке, крупнее)
- **(Если рассматривать не STM32) Real‑time контроллер — варианты по доступности/цене и простоте старта**:
  - **RP2040 (Raspberry Pi Pico / совместимые)** — *рекомендованный non‑STM32 default*:
    - плюсы: очень дёшево/доступно, прошивка по USB, много PWM, PIO удобно под RC‑сигналы
    - минусы: 3.3V логика (нужна аккуратность с 5V сигналами), питание/земля по правилам как и у STM32
    - выбранный вариант: **Raspberry Pi Pico Black Board (RP2040, 16MB, Type‑C)** — [Яндекс Маркет](https://market.yandex.ru/card/modul-raspberry-pi-pico-black-board-rp2040-16mb-type-c/101977621941?do-waremd5=KXwAQBbWM23jC4k_WKwjUA&ogV=-9)
  - **ESP32‑S3 “всё в одном” (без отдельного MCU)** — *если важнее минимум железа*:
    - плюсы: один чип = меньше проводов/плат
    - минусы: сложнее гарантировать стабильный PWM и низкий джиттер, т.к. Wi‑Fi/стек и real‑time на одном чипе
- **ESP32 DevKit** (Wi‑Fi + веб‑пульт).
  - выбранный вариант: **ESP32‑S3 Zero mini** — [Яндекс Маркет](https://market.yandex.ru/card/maketnaya-plata-esp32-s3-zero-mini-dlya-proyekta-iot-24-ggts-wi-fi-bluetooth/103634232370?do-waremd5=vxTuEkoNEHaFL1-hMP5q0g&ogV=-9)
  - по пин-ауту (см. фото): выведены **5V / GND / 3V3** и отдельные **TX/RX** — удобно питать от 5V (BEC/buck) и связывать с RP2040 по UART
  - что проверить по S3 Zero mini: наличие/качество антенны (дальность AP), хватает ли GPIO под ваши кнопки/индикацию (плата компактная), не подаёте ли одновременно 5V с USB и внешние 5V (лучше выбрать один источник питания)
  - альтернатива (часто **лучше для старта**): полноразмерный **ESP32‑S3 DevKit / ESP32‑S3‑WROOM‑1**:
    - плюсы: больше GPIO, удобнее макетировать, как правило лучше питание/разъёмы, проще выводить UART/I2C/кнопки/индикацию
    - минусы: крупнее
    - примечание: аккуратно со **strap/boot** пинами (например, `GPIO0` BOOT) и с пинами USB (`GPIO19/20`), чтобы не занять их случайно под “постоянные” функции
- **IMU** (акселерометр+гироскоп):
  - рекомендую: `LSM6DSO` или `BMI270` (точнее/тише, чем MPU‑6050)
  - примечание: `BMI270` как чип часто доступен, но **готовые breakout‑платы встречаются реже и стоят заметно дороже**, поэтому для MVP допустимо начать с `MPU‑6050`, а “хорошую” IMU выбрать после
  - допустимо для старта: `MPU‑6050` (дёшево, много примеров)
- **DC‑DC питание**:
  - 5V 2–3A (ESP32 + серво пиково)
  - 3.3V (если не уверены в стабилизаторе на dev‑плате / хотите чище питание IMU)
  - опционально (решить после диагностики базы): Mini560 Pro `5–32V → 3.3V` (заявлено до 5A) — [Яндекс Маркет](https://market.yandex.ru/card/ponizhayushchiy-dc-dc-preobrazovatel-mini560-pro-iz-5-32v-v-33v-5a/103022207609?do-waremd5=Y9qDtNmxAfLHJ0cy-D2PcA&ogV=-9)
    - примечание по модулю (по фото типовой платы): вход обычно **~5.5–32V**, есть пин **EN** (HIGH=enable, LOW=disable, часто с внутренней подтяжкой к enable по умолчанию)
  - рекомендация: сначала обеспечить **стабильные 5V 2–3A** (от BEC ESC или отдельным buck), а **3.3V** взять с регуляторов на RP2040/ESP32 платах; отдельный 3.3V buck покупать только если выяснится, что “5V шумные/проседают” или плата ESP32 требует только 3.3V
- **Проводка/мелочёвка**: JST‑разъёмы, Dupont, термоусадка, конденсаторы 470–1000µF на 5V шину.

## Управление с RC‑пульта (второй источник)
- **Пульт + приёмник** (если у машинки штатный пульт не отдаёт стандартные сигналы):
  - бюджет: FlySky `FS‑i6` + `iA6B` (или любой приёмник с PWM на каналах)
  - продвинуто: ELRS + CRSF (удобно по UART, но сложнее/дороже)
- **(Опционально) переключатель режима**: тумблер/кнопка на корпусе или отдельный RC‑канал.

## Ветка A (оставляем штатные ESC/серво)
Подходит, если у машинки уже есть:
- серва с **3 проводами**
- ESC/плата, которая принимает **классический PWM газа** (как от RC‑приёмника)

Тогда достаточно:
- STM32 генерирует PWM:
  - **THR** (газ) → вход ESC
  - **STR** (руль) → серва

Практический критерий “ветка A точно возможна”:
- у приёмника/платы есть **стандартные 3‑pin разъёмы** (часто `CH1/CH2` или `STR/THR`) или отдельный вход управления ESC/сервой.

## Ветка B (замена “toy‑grade” электроники)
Нужно, если штатная плата не имеет входов PWM или руль не на серве.

Типовой набор:
- **Brushed ESC с BEC 5V** (для коллекторного мотора) — проще всего для ретрофита.
  - ориентир: 20–30A ESC с выходом 5V (BEC) для сервы
- **Серва** (если штатная нестандартная):
  - классический размер 17–20g под 1/16–1/12
- **RC‑приёмник** (для режима с пультом), либо только Wi‑Fi (если пульт не нужен)

## Рекомендованные “дефолты”, если нет данных по машинке
- Предположить **коллекторный мотор** и идти по ветке **B** (самый предсказуемый ретрофит «без сюрпризов»).
- Питание считать **2S (7.4V)** и ставить **DC‑DC 5V 3A** (серво даёт пики тока).

## Рекомендация для первого прототипа (если модель ещё не выбрана)
- **Стартуйте с ветки B**: brushed‑ESC с BEC 5V + штатная/новая серво + (по желанию) отдельный RC‑приёмник.
  Это гарантирует, что STM32 сможет управлять машиной через стандартный PWM, независимо от того, какая «игрушечная» плата стояла изначально.
- **Ветка A** остаётся как “быстрый путь”, если вы найдёте hobby‑grade базу с явными разъёмами `THR/STR`.
  Тогда часто можно оставить ESC/серво и заменить только «приёмник» на STM32.



# Настройки платы в KiCad для RC Vehicle проекта

**Версия KiCad:** 9.0
**Язык интерфейса:** Английский (English)
**Последнее обновление:** 2026-01-23
**Оптимизация стоимости:** Рекомендации основаны на технологических нормах производителей:

- Китайские производители (JLCPCB, PCBWAY) через [sobol-e.ru](https://sobol-e.ru/pcb-production/)
- Российские производители (PCBPI, Rezonit) — см. раздел 13.5

## Обзор

Этот документ содержит рекомендации по настройкам платы в KiCad 9.0 (английская версия) для проекта RC Vehicle с компонентами:

**Примечание:** Все пути к меню и настройкам указаны для английской версии KiCad. Если у вас русская версия, названия меню могут отличаться.

- STM32G431CBTxZ (LQFP48, 0.5mm pitch)
- ESP32-C3-DevKitM-1
- LSM6DSM (LGA-14L, 0.5mm pitch)
- TXS0104ED (SOIC-14, 1.27mm pitch)
- LP5907MFX-3.3 (SOT-23)

## 1. Единицы измерения

**Рекомендуется:** Использовать **миллиметры (mm)** для удобства работы с метрическими компонентами.

**Как установить:**

- В PCB Editor: `View → Units → Millimeters` или нажмите `Ctrl+Shift+U`
- Или в настройках: `Preferences → General → Units`

## 2. Настройки сетки (Grid)

**Рекомендуемые значения:**

- **Сетка для размещения компонентов:** 0.5 mm (для LQFP48 с pitch 0.5mm)
- **Сетка для трассировки:** 0.1 mm или 0.05 mm
- **Сетка для размещения переходных отверстий:** 0.1 mm

**Как установить в KiCad 9.0:**

**Способ 1: Горячие клавиши (самый быстрый)**

- `Ctrl+1` — сетка 1 mm
- `Ctrl+2` — сетка 0.5 mm
- `Ctrl+3` — сетка 0.1 mm
- `Ctrl+4` — сетка 0.05 mm
- `Ctrl+5` — сетка 0.025 mm

**Способ 2: Через контекстное меню (правый клик) — РЕКОМЕНДУЕТСЯ**

- Правый клик на рабочей области платы → `Grid...` → выберите значение из списка
- Это самый простой способ в KiCad 9.0

**Способ 3: Через панель инструментов**

- Найдите кнопку сетки в верхней панели инструментов (обычно показывает текущее значение сетки, например "0.5 mm")
- Кликните на неё и выберите нужное значение из выпадающего списка

**Способ 4: Через Preferences (для английской версии)**

- `Preferences → PCB Editor → Display Options` → раздел "Grid"
- Или `Preferences → General → Display` → настройки сетки

**Примечание:** В KiCad 9.0 меню `View` не содержит прямого пункта Grid. Используйте правый клик на рабочей области или горячие клавиши `Ctrl+1`, `Ctrl+2`, `Ctrl+3`.

## 3. Design Rules (Правила проектирования)

**Путь в KiCad 9.0:** `File → Board Setup` (или нажмите `Alt+P`) → вкладка "Design Rules"

**Примечание:** В KiCad 9.0 интерфейс Board Setup был улучшен, все настройки находятся в одном окне с вкладками.

### 3.1. Минимальные зазоры (Clearance)

**Рекомендуемые значения:**

| Тип | Значение | Примечание |
|-----|----------|------------|
| **Минимальный зазор между дорожками** | **0.1 mm** | Для сигнальных дорожек |
| **Минимальный зазор до края платы** | **0.5 mm** | Безопасное расстояние |
| **Минимальный зазор вокруг отверстий** | **0.25 mm** | Для переходных отверстий |
| **Минимальный зазор между отверстиями** | **0.25 mm** | |
| **Минимальный зазор до маски** | **0.0 mm** | (по умолчанию) |

**Для плотной разводки (LQFP48, LGA-14L):**

- Можно уменьшить до **0.08 mm**, но это требует более точного производства и **увеличивает стоимость**
- **Рекомендуется:** оставить **0.1 mm** для надежности и **стандартной стоимости производства**

**Примечание о стоимости:** Согласно технологическим нормам производителей (JLCPCB, PCBWAY), минимальный зазор **0.10 mm** является стандартным для 2-слойных плат и не увеличивает стоимость. Уменьшение до 0.08-0.09 mm может потребовать более дорогого производства.

**Как установить в KiCad 9.0 (английская версия):**

1. Откройте `File → Board Setup` (или нажмите `Alt+P`)
2. Перейдите на вкладку **"Design Rules"**
3. В левой панели выберите раздел **"Constraints"** (или **"Clearance"**)
4. Найдите раздел **"Minimum Clearance"** и установите значение:
   - **Минимальный зазор между дорожками:** `0.1 mm` (в поле "Minimum clearance")
5. Для зазора до края платы:
   - Найдите раздел **"Board Outline Clearance"** (или **"Edge Clearance"**)
   - Установите значение `0.5 mm`
6. Для зазора вокруг отверстий:
   - Найдите раздел **"Hole to Hole Clearance"** (или **"Via Clearance"**)
   - Установите значение `0.25 mm`
7. Нажмите **"OK"** для сохранения настроек

**Альтернативный способ (через Net Classes):**

Если нужно установить разные зазоры для разных классов сетей:

1. `File → Board Setup` → вкладка **"Net Classes"**
2. Выберите класс сети (например, "Default") или создайте новый
3. В разделе **"Clearance"** установите нужное значение
4. Для каждого класса сети можно установить свой зазор

**Примечание:** В KiCad 9.0 минимальный зазор можно также установить глобально в разделе "Constraints" вкладки "Design Rules", и он будет применяться ко всем сетям, если не переопределен в Net Classes.

### 3.2. Ширина дорожек (Track Width)

**Минимальная ширина дорожки:** **0.1 mm** (для сигнальных дорожек)

**Рекомендуется:** использовать разные классы сетей (Net Classes) для разных типов сигналов (см. раздел 4)

**Примечание о стоимости:**

- Ширина дорожки **0.10 mm** — стандартная для 2-слойных плат с медью 35 мкм, **не увеличивает стоимость**
- Уменьшение до 0.08-0.09 mm возможно, но может потребовать более дорогого производства
- Для питания рекомендуется использовать более широкие дорожки (0.5 mm) для снижения сопротивления

### 3.3. Переходные отверстия (Vias)

**Рекомендуемые значения (для стандартной стоимости):**

| Параметр | Значение | Примечание |
|----------|----------|------------|
| **Via Hole (диаметр отверстия/сверления)** | **0.3 mm** | Стандартное значение для 2-слойных плат |
| **Via Size (внешний диаметр, плотная разводка)** | **0.4-0.45 mm** | Для плотной разводки (LQFP48, LGA-14L) |
| **Via Size (внешний диаметр, надежное)** | **0.5 mm** | Рекомендуется для надежности |
| **Annular Ring (кольцо вокруг отверстия)** | **≥0.25 mm** | Рекомендуется для надежности |
| **Annular Ring (плотная разводка)** | **0.05-0.075 mm** | Минимальный для 0.4-0.45mm Via Size |

**Для плотной разводки (LQFP48, LGA-14L):**

- **Рекомендуется:** использовать **Via Size 0.4-0.45 mm** с **Via Hole 0.3 mm**
- Annular ring будет **0.05-0.075 mm** (минимальный, но приемлемый для плотной разводки)
- **Альтернатива:** использовать **Via Size 0.5 mm** с **Via Hole 0.3 mm** для большей надежности, если позволяет место

**Примечание о стоимости:**

- **Via Hole 0.3 mm** — стандартный для 2-слойных плат, **не увеличивает стоимость**
- **Via Hole 0.15 mm** — минимальный, но **дороже** в производстве (избегайте, если не критично)
- Переходные отверстия **Via Size 0.4-0.45 mm** с **Via Hole 0.3 mm** — оптимальны для плотной разводки и стандартной стоимости

### 3.4. Микропереходные отверстия (Microvias)

**Для этого проекта не требуются** (односторонняя или двухсторонняя плата достаточна)

Если планируется многослойная плата:

- Диаметр: **0.2 mm**
- Сверление: **0.1 mm**

## 4. Net Classes (Классы сетей)

**Путь в KiCad 9.0 (английская версия):** `File → Board Setup` → вкладка "Net Classes"

**Примечание:** В KiCad 9.0 Net Classes находятся в отдельной вкладке в окне Board Setup. Можно также открыть через `Design Rules → Net Classes` в старых версиях.

**Рекомендуемые классы сетей:**

### 4.1. Default (сигнальные дорожки)

| Параметр | Значение | Примечание |
|----------|----------|------------|
| **Track Width** | **0.2 mm** | Для сигнальных дорожек (SPI, UART, PWM) |
| **Via Size** | **0.4-0.45 mm** | Внешний диаметр переходного отверстия (для плотной разводки) |
| **Via Hole** | **0.3 mm** | Диаметр отверстия (сверления), минимальное значение |
| **Clearance** | **0.1 mm** | |
| **Diff Pair Width** | **0.2 mm** | (если используется) |
| **Diff Pair Gap** | **0.25 mm** | (если используется) |

### 4.2. Power (питание)

**Создать новый класс:** `Power` или `3V3_Power`

| Параметр | Значение | Примечание |
|----------|----------|------------|
| **Track Width** | **0.5 mm** | Для питания 3.3V |
| **Via Size** | **0.6 mm** | Внешний диаметр переходного отверстия |
| **Via Hole** | **0.3 mm** | Диаметр отверстия (сверления) |
| **Clearance** | **0.2 mm** | Больше для питания |

**Применить к сетям:**

- `+3.3V`, `3V3`, `LSM_VDD`
- Все сети питания 3.3V

### 4.3. Power_5V (питание 5V)

**Создать новый класс:** `Power_5V`

| Параметр | Значение | Примечание |
|----------|----------|------------|
| **Track Width** | **0.5 mm** | Для питания 5V |
| **Via Size** | **0.6 mm** | Внешний диаметр переходного отверстия |
| **Via Hole** | **0.3 mm** | Диаметр отверстия (сверления) |
| **Clearance** | **0.2 mm** | |

**Применить к сетям:**

- `5V1`, `VDD5`, `+5V`
- Все сети питания 5V

### 4.4. GND (земля)

**Создать новый класс:** `GND`

| Параметр | Значение | Примечание |
|----------|----------|------------|
| **Track Width** | **0.3-0.5 mm** | Для дорожек земли |
| **Via Diameter** | **0.6 mm** | |
| **Via Drill** | **0.3 mm** | |
| **Clearance** | **0.1 mm** | |

**Применить к сетям:**

- `GND`
- Все сети земли

**Рекомендация:** Использовать **полигоны (zones)** для земли вместо дорожек (см. раздел 6)

### 4.5. SPI (высокочастотные сигналы)

**Создать новый класс:** `SPI` (опционально)

| Параметр | Значение | Примечание |
|----------|----------|------------|
| **Track Width** | **0.15 mm** | Для SPI (до 10 MHz), можно использовать 0.1 mm для экономии |
| **Via Size** | **0.4-0.45 mm** | Внешний диаметр переходного отверстия (для плотной разводки) |
| **Via Hole** | **0.3 mm** | Диаметр отверстия (сверления), минимальное значение |
| **Clearance** | **0.1 mm** | Стандартный зазор |

**Применить к сетям:**

- `SPI2_SCK`, `SPI2_MOSI`, `SPI2_MISO`, `SPI2_LSM_CS`

## 5. Настройки слоев (Layer Stackup)

**Путь в KiCad 9.0 (английская версия):** `File → Board Setup` → вкладка "Physical Stackup"

**Примечание:** В KiCad 9.0 настройки слоев и стека платы объединены в одной вкладке "Physical Stackup".

### 5.1. Для двухслойной платы (рекомендуется для начала)

**Слои:**

- **F.Cu (Front Copper)** — верхний слой
- **B.Cu (Back Copper)** — нижний слой

**Толщина платы:** **1.6 mm** (стандартная)

**Толщина меди:** **35 µm** (1 oz) — стандартная

### 5.2. Для четырехслойной платы (для сложной разводки)

**Слои:**

- **F.Cu** — верхний слой (сигналы)
- **In1.Cu** — внутренний слой 1 (GND plane)
- **In2.Cu** — внутренний слой 2 (Power plane или сигналы)
- **B.Cu** — нижний слой (сигналы)

**Преимущества:**

- Лучшая разводка питания (power planes)
- Лучшая разводка земли (GND plane)
- Меньше переходных отверстий
- Лучшая ЭМС

**Недостатки:**

- **Дороже производство** (примерно в 2-3 раза дороже 2-слойной платы)
- Сложнее отладка
- Дольше срок производства

**Рекомендация:** Используйте 4-слойную плату только если действительно необходима для сложной разводки. Для большинства проектов 2-слойной платы достаточно.

## 6. Полигоны (Zones) для питания и земли

**Рекомендация:** Использовать полигоны для питания и земли вместо дорожек.

### 6.1. Полигон для GND

**Как создать в KiCad 9.0 (английская версия):**

1. `Place → Zone` или нажмите `Ctrl+Shift+Z` (или кнопка на панели инструментов)
2. Выберите слой (F.Cu или B.Cu) в панели слоев слева
3. Нарисуйте контур полигона (вокруг компонентов или по всей плате) — кликните точки контура, затем правый клик для завершения
4. В диалоге свойств зоны (появится автоматически или двойной клик на зоне):
   - **Net:** `GND`
   - **Layer:** `F.Cu` и/или `B.Cu`
   - **Clearance:** `0.1 mm`
   - **Min Width:** `0.2 mm`
   - **Pad Connection:** `Thermal Relief` (рекомендуется) или `Solid`

**Рекомендация:** Создать полигон GND на обоих слоях и соединить через переходные отверстия.

### 6.2. Полигон для 3.3V

**Как создать в KiCad 9.0 (английская версия):**

1. Аналогично полигону GND (`Place → Zone` или `Ctrl+Shift+Z`)
2. **Net:** `3V3` или `+3.3V`
3. **Layer:** `F.Cu` (или внутренний слой, если 4-слойная плата)
4. **Clearance:** `0.2 mm` (больше для питания)

**Примечание:** Полигон для питания можно сделать меньше, чем для GND (только вокруг компонентов, которым нужно питание).

## 7. Настройки переходных отверстий (Vias)

**Путь в KiCad 9.0 (английская версия):** `File → Board Setup` → вкладка "Design Rules" → раздел "Via Dimensions"

**Рекомендуемые размеры (для стандартной стоимости производства):**

| Тип | Via Size | Via Hole | Annular Ring | Применение |
|-----|----------|----------|--------------|------------|
| **Стандартное (плотная разводка)** | **0.4-0.45 mm** | **0.3 mm** | **0.05-0.075 mm** | Сигнальные дорожки (LQFP48, LGA-14L) |
| **Стандартное (надежное)** | **0.5 mm** | **0.3 mm** | **≥0.25 mm** | Сигнальные дорожки (рекомендуется) |
| **Питание** | **0.6 mm** | **0.3 mm** | **≥0.25 mm** | Питание 3.3V, 5V |
| **Земля** | **0.6 mm** | **0.3 mm** | **≥0.25 mm** | GND |

**Примечания о стоимости:**

- **Via Hole (диаметр отверстия):** **0.3 mm** — стандартный для 2-слойных плат, **не увеличивает стоимость**
- **Via Size (внешний диаметр):** **0.4-0.45 mm** — для плотной разводки (LQFP48, LGA-14L)
- **Via Size (внешний диаметр):** **0.5 mm** — рекомендуется для надежности и стандартной стоимости
- **Via Hole 0.15 mm** — минимальный, но **дороже** в производстве (избегайте, если не критично)
- Annular ring **≥0.25 mm** — рекомендуется для надежности
- Annular ring **0.05-0.075 mm** — минимальный для плотной разводки (Via Size 0.4-0.45mm с Via Hole 0.3mm)

**Рекомендация:** Для плотной разводки (LQFP48, LGA-14L) можно использовать переходные отверстия **Via Size 0.4-0.45 mm** с **Via Hole 0.3 mm**, но для надежности лучше использовать **Via Size 0.5 mm**, если позволяет место.

## 8. Настройки падов (Pads)

**Путь:** `File → Board Setup` → вкладка "Design Rules" → "Solder Mask & Paste"

**Рекомендуемые значения:**

| Параметр | Значение | Примечание |
|----------|----------|------------|
| **Solder Mask Clearance** | **0.0 mm** | (по умолчанию) |
| **Solder Mask Min Width** | **0.0 mm** | (по умолчанию) |
| **Solder Paste Clearance** | **0.0 mm** | (по умолчанию) |
| **Solder Paste Ratio** | **1.0** | (по умолчанию) |

**Для мелких компонентов (LQFP48, LGA-14L):**

- Обычно настройки по умолчанию достаточны
- Footprint компонентов уже содержат правильные размеры падов

## 9. Настройки текста на плате

**Путь в KiCad 9.0 (английская версия):** `File → Board Setup` → вкладка "Text & Graphics Defaults"

**Рекомендуемые значения:**

| Тип | Размер | Толщина | Примечание |
|-----|--------|---------|------------|
| **Silkscreen (F.SilkS)** | **1.0 mm** | **0.1 mm** | Текст на шелкографии |
| **Copper (F.Cu)** | **1.5 mm** | **0.3 mm** | Текст на меди (референсы) |
| **Fab (F.Fab)** | **1.0 mm** | **0.15 mm** | Текст для производства |

## 10. Настройки для трассировки

### 10.1. Автоматическая трассировка (опционально)

**KiCad не имеет встроенного autorouter**, но можно использовать внешние инструменты:

- **FreeRouting** (Java-based)
- **TopoR** (коммерческий)

**Рекомендация:** Ручная трассировка дает лучшие результаты для этого проекта.

### 10.2. Рекомендации по ручной трассировке

1. **Сначала разведите питание и землю:**
   - Полигоны для GND
   - Дорожки для питания (3.3V, 5V)

2. **Затем разведите критические сигналы:**
   - SPI (SCK, MOSI, MISO, CS) — короткие дорожки
   - UART (TX, RX) — короткие дорожки
   - PWM (через level-shifter) — можно длиннее

3. **Избегайте параллельных дорожек:**
   - Минимизируйте параллельные дорожки для уменьшения перекрестных помех

4. **Используйте переходные отверстия разумно:**
   - Не создавайте слишком много переходных отверстий
   - Группируйте переходные отверстия для удобства разводки

## 11. Проверка правил (DRC - Design Rule Check)

**Путь:** `Inspect → Design Rules Checker` или нажмите `Ctrl+Shift+D`

**Перед отправкой на производство обязательно:**

1. [ ] Запустить DRC
2. [ ] Исправить все ошибки (Errors)
3. [ ] Проверить предупреждения (Warnings)
4. [ ] Убедиться, что нет неподключенных сетей
5. [ ] Проверить, что все компоненты размещены
6. [ ] Проверить, что все дорожки проложены

## 12. Экспорт для производства

**Путь в KiCad 9.0 (английская версия):** `File → Fabrication Outputs → Gerbers` или `File → Plot`

**Рекомендуемые слои для экспорта:**

- **F.Cu** — верхний слой меди
- **B.Cu** — нижний слой меди
- **F.Paste** — паяльная паста (верх)
- **B.Paste** — паяльная паста (низ)
- **F.Mask** — маска (верх)
- **B.Mask** — маска (низ)
- **F.SilkS** — шелкография (верх)
- **B.SilkS** — шелкография (низ)
- **Edge.Cuts** — контур платы
- **F.Fab** — слой для производства (опционально)

**Формат:** **Gerber X2** (рекомендуется) или **Gerber RS-274X**

**Drill файл:** `File → Fabrication Outputs → Drill Files`

- Формат: **Excellon**
- Единицы: **Millimeters**

## 13. Чеклист перед отправкой на производство

- [ ] Все компоненты размещены
- [ ] Все дорожки проложены
- [ ] Полигоны для GND созданы
- [ ] Полигоны для питания созданы (если нужно)
- [ ] DRC пройден без ошибок
- [ ] Проверены минимальные зазоры (0.1 mm)
- [ ] Проверены минимальные ширины дорожек (0.1 mm)
- [ ] Проверены размеры переходных отверстий (0.4-0.45/0.3 mm или 0.5/0.3 mm)
- [ ] Экспортированы Gerber файлы
- [ ] Экспортирован Drill файл
- [ ] Проверены файлы перед отправкой

## 15. Специфичные настройки для компонентов проекта

### 14.1. STM32G431CBTxZ (LQFP48, 0.5mm pitch)

- **Минимальная ширина дорожки:** 0.1 mm
- **Минимальный зазор:** 0.1 mm
- **Рекомендуется:** использовать полигон GND под микроконтроллером

### 14.2. LSM6DSM (LGA-14L, 0.5mm pitch)

- **Минимальная ширина дорожки:** 0.1 mm
- **Минимальный зазор:** 0.1 mm
- **Рекомендуется:** короткие дорожки для SPI (минимизировать паразитную индуктивность)

### 14.3. TXS0104ED (SOIC-14, 1.27mm pitch)

- **Минимальная ширина дорожки:** 0.2 mm (можно тоньше)
- **Минимальный зазор:** 0.1 mm
- **Рекомендуется:** короткие дорожки для PWM сигналов

### 15.4. LP5907MFX-3.3 (SOT-23)

- **Минимальная ширина дорожки:** 0.3 mm для питания
- **Минимальный зазор:** 0.1 mm
- **Рекомендуется:** широкие дорожки для входного и выходного питания

## 15. Дополнительные рекомендации

### 15.1. Размещение компонентов

1. **Разместите стабилизатор (U2) близко к разъему питания**
2. **Разместите конденсаторы близко к выводам питания компонентов**
3. **Разместите кварцы близко к STM32**
4. **Разместите level-shifter (U4) между STM32 и разъемами ESC/Servo**

### 16.2. Разводка питания

1. **Используйте звездообразную разводку питания** (star routing)
2. **Разведите питание сначала, затем сигналы**
3. **Используйте полигоны для GND на обоих слоях**

### 15.3. Разводка сигналов

1. **Короткие дорожки для SPI** (минимизировать задержки)
2. **Избегайте параллельных дорожек** (уменьшить перекрестные помехи)
3. **Используйте переходные отверстия разумно** (не создавайте слишком много)

## 17. Полезные горячие клавиши

| Клавиша | Действие |
|---------|----------|
| Правый клик → `Grid...` | Установить сетку (KiCad 9.0) |
| `Ctrl+1` | Сетка 1 mm |
| `Ctrl+2` | Сетка 0.5 mm |
| `Ctrl+3` | Сетка 0.1 mm |
| `Ctrl+Shift+U` | Переключить единицы (mm/inches) |
| `Ctrl+Shift+Z` | Создать полигон (zone) |
| `Ctrl+Shift+D` | Запустить DRC |
| `E` | Редактировать элемент |
| `M` | Переместить элемент |
| `R` | Повернуть элемент |
| `X` | Начать трассировку |
| `V` | Создать переходное отверстие |

## Ссылки

- [KiCad Documentation](https://docs.kicad.org/)
- [KiCad Design Rules](https://docs.kicad.org/pcbnew/8.0/en/drc.html)
- [STM32G431 Datasheet](https://www.st.com/resource/en/datasheet/stm32g431cb.pdf)
- [LSM6DSM Datasheet](https://www.st.com/resource/en/datasheet/lsm6dsm.pdf)
